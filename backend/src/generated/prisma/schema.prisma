// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider   = "prisma-client-js"
  output     = "../generated/prisma"
  engineType = "library"
}

datasource db {
  provider = "sqlite"
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  purchases    Purchase[]
  sales        Sale[]
  prices       ProductPrice[]
  StockSummary StockSummary[]
}

model Supplier {
  id          String   @id @default(uuid())
  name        String
  contactInfo String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  purchases Purchase[]
}

model Purchase {
  id             String    @id @default(uuid())
  productId      String
  supplierId     String
  quantity       Int
  unitCost       Decimal
  expirationDate DateTime?
  purchasedAt    DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  product  Product  @relation(fields: [productId], references: [id])
  supplier Supplier @relation(fields: [supplierId], references: [id])
}

model Sale {
  id        String   @id @default(uuid())
  productId String
  quantity  Int
  soldAt    DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id])
}

model StockSummary {
  id                String    @id @default(uuid())
  productId         String
  nextToExpire      DateTime?
  availableQuantity Int
  lastUpdated       DateTime  @updatedAt

  product Product @relation(fields: [productId], references: [id])

  @@unique(productId)
}

model ProductPrice {
  id          String   @id @default(uuid())
  productId   String
  price       Decimal
  effectiveAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id])
}

model User {
  id           String @id @default(uuid())
  email        String @unique
  passwordHash String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
